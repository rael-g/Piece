# Piece Engine CI/CD Strategy

This document describes the Continuous Integration (CI) and Continuous Delivery (CD) strategy for the Piece Engine, leveraging GitHub Actions to automate building, testing, and publishing the engine.

## 1. Core Principles

*   **Continuous Integration (CI):** Every code change triggers an automated build and test process to ensure early detection of issues.
*   **Continuous Delivery (CD):** Verified changes on the `main` branch trigger a process that prepares a new release, including versioning, release note generation, and artifact packaging.
*   **Fast Feedback:** Pipelines are designed for efficiency to provide rapid feedback to developers.
*   **Reproducibility:** Builds and releases must be consistent and reproducible.
*   **Platform Agnosticism:** Pipelines support building and testing on multiple operating systems (Windows, Linux).

## 2. Tools

*   **GitHub Actions:** The primary tool for orchestrating CI/CD pipelines.
*   **GitVersion:** A tool that uses Git history and commit messages (following the [Conventional Commits](https://www.conventionalcommits.org/) standard) to automatically determine the project's next semantic version and generate release notes.
*   **CMake & vcpkg:** For configuring and building C++ projects and their dependencies.
*   **.NET SDK:** For building, testing, and packaging C# projects.

## 3. Pipeline Architecture: CI and CD Workflows

The strategy is divided into two independent workflows, following best practices for separation of responsibilities: `ci.yml` and `cd.yml`.

### 3.1. Continuous Integration Workflow (`ci.yml`)

This is the verification and validation pipeline.

*   **Workflow Name:** `Continuous Integration`
*   **Triggers:** Executes on every `push` to any branch and on every `pull_request` opened against the `main` branch.
*   **Responsibilities:**
    1.  **Multi-platform Build:** Executes a build matrix to compile all C++ and C# code on `windows-latest` and `ubuntu-latest` (currently for `x64` architecture).
    2.  **Test Execution:** Runs all C++ (with CTest) and C# (with `dotnet test`) unit and integration tests for each platform.
    3.  **Artifact Upload:** If the build and tests are successful, it uploads the compiled C++ binaries as artifacts (e.g., `build-windows-latest-x64`). These artifacts are temporarily stored to be consumed by the CD workflow.

### 3.2. Continuous Deployment Workflow (`cd.yml`)

This is the pipeline that creates and publishes official releases.

*   **Workflow Name:** `Continuous Deployment`
*   **Trigger:** Executes only on `push` events to the `main` branch.
*   **Responsibilities:**
    1.  **Versioning:** Runs `GitVersion` to analyze commit history, determine the new semantic version, and generate release notes.
    2.  **Artifact Assembly:** Downloads the build artifacts (for all platforms) that were generated by the CI workflow for the same commit.
    3.  **Packaging:** This phase is responsible for creating the final packages:
        *   **Standalone Editor:** Uses `dotnet publish` to create "zip-and-run" packages for each platform, bundling the C# host with the necessary C++ binaries.
        *   **NuGet Packages:** Uses `dotnet pack` to create `.nupkg` packages for the Piece.Framework's libraries, intended for developers.
        *   **Vcpkg Packages:** Creates the necessary `portfile.cmake` and manifest files for publishing Piece.Core as a `vcpkg` port, enabling consumption in C++ projects.
    4.  **Release Publication:** Uses the `softprops/action-gh-release` action to:
        *   Create a new Git Tag and a new GitHub Release with the version determined by `GitVersion`.
        *   Populate the release body with automatically generated release notes.
        *   Upload the Editor packages and NuGet packages as release assets.
        *   Publish NuGet packages to `NuGet.org`.
        *   Publish the Vcpkg port by submitting a pull request to the official vcpkg repository or a custom registry.